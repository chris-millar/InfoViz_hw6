<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="d3lib/d3.js"></script>
	<script type="text/javascript" src="d3lib/d3.csv.js"></script>
	<script type="text/javascript" src="d3lib/d3.geom.js"></script>
    <script type="text/javascript" src="d3lib/d3.layout.js"></script>
    <link rel="stylesheet" type="text/css" href="css/test.css" />
	
</head>

<body>
    <div id="title"></div>
	<div id="chart"></div>
	<div id="label"></div>
	<div id="button"></div>
    <button>Show Gold Medals</button>
    <script type="text/javascript" charset="utf-8">
    
    d3.select("body").select("#title").text("US Olympic Medals").attr("class","title");
    
    d3.csv("US_medals.csv", function(data)
    {
	    var barWidth = 40;
	    var width = 1200;
	    var height = 350;
	    var color = d3.scale.category20c();
    		
	    var x = d3.scale.linear().domain([0, data.length]).range([20, width]);
	    var y = d3.scale.linear().domain([0, d3.max(data, function(datum) { return datum.Total; })]).
	      rangeRound([0, height])
	    
	   
	    
    	var title = d3.select("#title").
            append("g").
            attr("width", width+600).
            attr("height", 50);
    	
	    var bars = d3.select("#chart").
	        append("svg:svg").
	        attr("width", width+600).
	        attr("height", height);

        var labels = d3.select("#label").
            append("svg:svg").
            attr("Width", width+600).
            attr("height", 20);
        
        
        var buttons = d3.select("#button").
            append("svg:svg").
            attr("Width", width+600).
            attr("height", 150);
        
        
	    bars.selectAll("line")
		     .data(y.ticks(20))
		     .enter().append("line")
		     .attr("x1", 0)
		     .attr("x2", 1200)
		     .attr("y1", function(i){return height - y(i);})
		     .attr("y2", function(i){return height - y(i);})
		     .style("stroke", "#999");
    		
	    bars.selectAll("rect").
	      data(data).
	      enter().
	      append("svg:rect").
	      attr("x", function(datum, index) { return x(index); }).
	      attr("y", function(datum) { return height - y(datum.Total); }).
	      attr("height", function(datum) { return y(datum.Total); }).
	      attr("width", barWidth).
	      attr("fill", "lightsteelblue")
	      .on("mouseover",function(datum){
	        buttons.select("text").attr("x", 20)
                .attr("y", 85)
                .attr("font-family", "sans-serif")
                .attr("font-size", "25px")
                .attr("fill","red")
                .text(datum.Total + " Medals in " + datum.Games);
            })
	      .on("mouseout",textOff);


	    bars.selectAll("text")
		    .data(y.ticks(20))
		    .enter().append("svg:text")
		    .attr("x", 10)
		    .attr("y", function(i){return height - y(i)+5;})
		    .attr("dy", "-0.5em") <!-- x and y displacement - for fine positioning of text -->
		    .attr("text-anchor", "middle")
		    .text(function(i){return i;})
		    .attr("fill","black");

        labels.selectAll("text")
            .data(data)
            .enter()
            .append("svg:text")
            .attr("x", function(datum, index) { return x(index)+ 5; })
            .attr("y", 15)
            .text(function(datum) { return datum.Year; });
        
        cir = ["lightsteelblue", "gold", "silver", "darkgoldenrod"];
        buttons.selectAll("circle")
            .data(cir)
            .enter().append("svg:circle")
            .style("fill", function(d){return d;})
            .attr("r", function(datum, index){
                           if(index == 0){
                            return 60;
                           }
                           else{
                            return 30;
                           }
                      }
            )
            .attr("cx", function(datum, index) { return index*150 + 400; })
            .attr("cy", 60)
            .on("mousedown", enlarge);
        
        buttonLabel = ["Total Medals", "Total Medals", "Gold Medals", "Silver Medals", "Bronze Medals"];
        buttons.selectAll("text")
            .data(buttonLabel)
            .enter().append("svg:text")
            .attr("x", function(datum, index) {return index*150+210; })
            .attr("y", 135)
            .text(function(datum) { return datum; });
        
        d3.select('button').on('click', changeData);
        
        function enlarge(){
            buttons.selectAll("circle").transition()
            .delay(0).duration(500).attr("r", 30);
            d3.select(this).transition()
            .delay(0).duration(500).attr("r", 60);
           
        }
        
        function changeData(){
          bars.selectAll("rect").remove().
          
          y = d3.scale.linear().domain([0, d3.max(data, function(datum) { return datum.Gold; })]).
	      rangeRound([0, height])
          
          bars.selectAll("rect").
	      data(data).
	      enter().
	      append("svg:rect").
	      attr("x", function(datum, index) { return x(index); }).
	      attr("y", function(datum) { return height - y(datum.Gold); }).
	      attr("height", function(datum) { return y(datum.Gold); }).
	      attr("width", barWidth).
	      attr("fill", "Gold")
	      .on("mouseover",function(datum){
	        buttons.select("text").attr("x", 20)
                .attr("y", 85)
                .attr("font-family", "sans-serif")
                .attr("font-size", "25px")
                .attr("fill","red")
                .text(datum.Gold + " Medals in " + datum.Games);
            })
	      .on("mouseout",textOff);
        
        
        }


	    function textOff()
	    {
	        buttons.select("text").text("");
	    };

	    }
    );
  </script>
  
</body>

</html>