<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="d3lib/d3.js"></script>
	<script type="text/javascript" src="d3lib/d3.csv.js"></script>
	<script type="text/javascript" src="d3lib/d3.geom.js"></script>
    <script type="text/javascript" src="d3lib/d3.layout.js"></script>
    <link rel="stylesheet" type="text/css" href="css/test.css" />
	
</head>

<body>
    <div id="title"></div>
	<div id="chart"></div>
	<div id="label"></div>
	<div id="button"></div>
    <!--<button>Show Gold Medals</button> -->
    <script type="text/javascript" charset="utf-8">
    
    var barCount;
    var globMax;

    d3.select("body").select("#title").text("US Olympic Medals").attr("class","title");
    
    d3.csv("US_medals.csv", function(data)
    {
	    var barWidth = 40;
	    var width = 1200;
	    var height = 350;
	    var color = d3.scale.category20c();
    		

	    
	   
	    
    	var title = d3.select("#title")
                      .append("g")
                      .attr("width", width+600)
                      .attr("height", 50);
    	
	    var bars = d3.select("#chart")
                     .append("svg:svg")
                     .attr("width", width+600)
                     .attr("height", height);

        var labels = d3.select("#label")
                       .append("svg:svg")
                       .attr("Width", width+600)
                       .attr("height", 20);
        
        var buttons = d3.select("#button")
                        .append("svg:svg")
                        .attr("Width", width+600)
                        .attr("height", 150);  

       changeData("Total");
/*

      var x = d3.scale.linear().domain([0, data.length]).range([20, width]);
      var y = d3.scale.linear().domain([0, d3.max(data, function(datum) { return datum.Total; })]).rangeRound([0, height])      

          globMax = 0;
          var val = d3.max(data, function(datum) { 
                window.globMax = Math.max(window.globMax, datum["Total"]);
                return window.globMax; 
          });
          y = d3.scale.linear().domain([0, globMax]).rangeRound([0, height]);
          //console.log(globMax);

          // Y-Axis Lines //
          bars.selectAll("line").remove();
          bars.selectAll("line")
            .data(y.ticks(20))
            .enter().append("line")
            .attr("x1", 0)
            .attr("x2", 1200)
            .attr("y1", function(i){return height - y(i);})
            .attr("y2", function(i){return height - y(i);})
            .style("stroke", "#999");

          bars.selectAll("text").remove();

          // Y-Axis Text //
          bars.selectAll("text")
            .data(y.ticks(20))
            .enter().append("svg:text")
            .attr("x", 10)
            .attr("y", function(i){return height - y(i)+5;})
            .attr("dy", "-0.5em") // x and y displacement - for fine positioning of text
            .attr("text-anchor", "middle")
            .text(function(i){return i;})
            .attr("fill","black");

      /////////////////////////////////////////////////////////////////////////////

      // Y-Axis Lines //
      /*
	    bars.selectAll("line")
		    .data(y.ticks(20))
		    .enter().append("line")
		    .attr("x1", 0)
		    .attr("x2", 1200)
		    .attr("y1", function(i){return height - y(i);})
		    .attr("y2", function(i){return height - y(i);})
		    .style("stroke", "#999");
    	*/
/*
        // Initial Bars for Bargraph //	
	    bars.selectAll("rect")
            .data(data)
            .enter()
            .append("svg:rect")
            .attr("x", function(datum, index) { return x(index); })
            .attr("y", 0)
            .attr("height", 0)
            .attr("width", barWidth)
            .attr("fill", "green")
	        .on("mouseover",function(datum){
                d3.select(this).style("fill", "#9999FF");
	            buttons.select("text").attr("x", 20)
                       .attr("y", 85)
                       .attr("font-family", "sans-serif")
                       .attr("font-size", "25px")
                       .attr("fill","red")
                       .text(datum.Total +  " Total in " + datum.Games);
            })
	        .on("mouseout",textOff)
            .on("mouseout", function() {
                d3.select(this).style("fill", pickColor("Total"))
              })
            .transition()
            .duration(3000)
            .attr("x", function(datum, index) { return x(index); })
            .attr("y", function(datum) { return height - y(datum.Total); })
            .attr("height", function(datum) { return y(datum.Total); })
            .attr("width", barWidth)
            .attr("fill", pickColor("Total"));

      // Y-Axis Text //
      /*
	    bars.selectAll("text")
		    .data(y.ticks(20))
		    .enter().append("svg:text")
		    .attr("x", 10)
		    .attr("y", function(i){return height - y(i)+5;})
		    .attr("dy", "-0.5em") // x and y displacement - for fine positioning of text
		    .attr("text-anchor", "middle")
		    .text(function(i){return i;})
		    .attr("fill","black");
        */
        
        var x = d3.scale.linear().domain([0, data.length]).range([20, width]);
        
        // Year Labels //
        labels.selectAll("text")
              .data(data)
              .enter()
              .append("svg:text")
              .attr("x", function(datum, index) { return x(index)+ 5; })
              .attr("y", 15)
              .text(function(datum) { return datum.Year; });


       // Circle Buttons //
        cir = ["Total", "Gold", "Silver", "Bronze"];
        
        buttons.selectAll("circle")
               .data(cir)
               .enter().append("svg:circle")
               .style("fill", function(d) {
                    return pickColor(d);
               })
               .attr("r", function(datum, index){
                    if(index == 0){
                        return 60;
                    }
                    else{
                        return 30;
                    }
               })
               .attr("cx", function(datum, index) { return index*150 + 400; })
               .attr("cy", 60)
               .on('click', changeData)
               .on("mousedown", enlarge);

        buttonLabel = ["", "Total Medals", "Gold Medals", "Silver Medals", "Bronze Medals"];
        buttons.selectAll("text")
               .data(buttonLabel)
               .enter().append("svg:text")
               .attr("x", function(datum, index) {return index*150+210; })
               .attr("y", 135)
               .text(function(datum) { return datum; });
        //d3.select('button').on('click', changeData("Gold"));
        
        // Helper Functions //

        function enlarge(){
            buttons.selectAll("circle")
                   .transition()
                   .delay(0).duration(500)
                   .attr("r", 30);

            d3.select(this)
              .transition()
              .delay(0).duration(500)
              .attr("r", 60);
        }
        
        function changeData(field){
          
          globMax = 0;
          var val = d3.max(data, function(datum) { 
                window.globMax = Math.max(window.globMax, datum[field]);
                return window.globMax; 
          });
          var x = d3.scale.linear().domain([0, data.length]).range([20, width]);
          var y = d3.scale.linear().domain([0, globMax]).rangeRound([0, height]);
          //console.log(globMax);

          // Y-Axis Lines //
          bars.selectAll("line").remove();
          bars.selectAll("line")
            .data(y.ticks(20))
            .enter().append("line")
            .attr("x1", 0)
            .attr("x2", 1200)
            .attr("y1", function(i){return height - y(i);})
            .attr("y2", function(i){return height - y(i);})
            .style("stroke", "black");
            //.style("stroke", "#999");

          bars.selectAll("text").remove();

          // Y-Axis Text //
          bars.selectAll("text")
            .data(y.ticks(20))
            .enter().append("svg:text")
            .attr("x", 10)
            .attr("y", function(i){return height - y(i)+5;})
            .attr("dy", "-0.5em") // x and y displacement - for fine positioning of text
            .attr("text-anchor", "middle")
            .text(function(i){return i;})
            .attr("fill","black");

          window.barCount = 0;

          bars.selectAll("rect").remove();
          bars.selectAll("rect")
	          .data(data)
	          .enter()
              .append("svg:rect")
              .attr("x", function(datum, index) { return x(index); })
              .attr("y", function(datum) { return height - y(datum[field]); })
              .attr("height", 0)
              .attr("width", barWidth)
              .attr("fill", pickColor(field))
	            .on("mouseover",function(datum){
                   d3.select(this).style("fill", "#9999FF");
	               buttons.select("text").attr("x", 20)
                          .attr("y", 85)
                          .attr("font-family", "sans-serif")
                          .attr("font-size", "25px")
                          .attr("fill","red")
                          .text(datum[field] + " " + field + " in " + datum.Games);
                    })
	            .on("mouseout",textOff)
              .on("mouseout", function() {
                    //console.log(field);
                    d3.select(this).style("fill", pickColor(field))
              })
              .transition()
              .duration(3000)
              .attr("x", function(datum, index) { return x(index); })
              .attr("y", function(datum) { return height - y(datum[field]); })
              .attr("height", function(datum) { return y(datum[field]); })
              .attr("width", barWidth)
              .attr("fill", pickColor(field))
              .attr("id", function() {
                    //console.log(window.barCount);
                    var ret = "bar_" + window.barCount;
                    window.barCount++;
                    return ret;
              });
        }

        function pickCount()
        {
            console.log(window.barCount);
            var ret = "bar_" + window.barCount;
            window.barCount++;
            return ret;
        }

        function pickColor(field)
        {
            if(field == "Total")
                return "#336600";
            else if (field == "Gold")
                return "#FFCC00"; //"yellow";
            else if (field == "Silver")
                return "Silver";
            else if (field == "Bronze")
                return "#CC6600";
            else
                return "red";
        }

	    function textOff()
	    {
	        buttons.select("text").text("");
	    };

	    }
    );
  </script>
  
</body>

</html>